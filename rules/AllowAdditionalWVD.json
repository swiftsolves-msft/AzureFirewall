//Azure Firewall Allow Additional WVD: https://docs.microsoft.com/en-us/azure/firewall/protect-windows-virtual-desktop
// XX.XX.XX.XX/YY << Is your WVD Host Pool Subnet
// ZZ.ZZ.ZZ.ZZ << Is your AD DNS Server IP


// For Network FQDN ensure you are using either DNSProxy at https://docs.microsoft.com/en-us/azure/firewall-manager/dns-settings

// or DNSSettings as

//    "dnsSettings": {
//	"servers": [],
//	"enableProxy": false,
//	"requireProxyForNetworkRules": false
//  },



							{
								"name": "AllowAdditionalWVDApp",
								"priority": 203,
								"ruleCollectionType": "FirewallPolicyFilterRuleCollection",
								"action": {
									"type": "Allow"
								},
								"rules": [
									{ 
										"ruleType": "ApplicationRule", 
										"name": "AllowWVDBlob", 
										"protocols":[ 
											{ 
												"protocolType":"Https", 
												"port":443 
											}
										],
										"targetUrls":[ 
											"*xt.blob.core.windows.net/*"
										],
										"sourceAddresses":[ 
											"XX.XX.XX.XX/YY"
										],
										"terminateTLS":true 
                                    },
									{ 
										"ruleType": "ApplicationRule", 
										"name": "AllowWVDServicebus", 
										"protocols":[ 
											{ 
												"protocolType":"Https", 
												"port":443 
											}
										],
										"targetUrls":[ 
											"*eh.servicebus.windows.net/*"
										],
										"sourceAddresses":[ 
											"XX.XX.XX.XX/YY"
										],
										"terminateTLS":true 
                                    },
									{ 
										"ruleType": "ApplicationRule", 
										"name": "AllowWVDTable", 
										"protocols":[ 
											{ 
												"protocolType":"Https", 
												"port":443 
											}
										],
										"targetUrls":[ 
											"*xt.table.core.windows.net/*"
										],
										"sourceAddresses":[ 
											"XX.XX.XX.XX/YY"
										],
										"terminateTLS":true 
									}
								]
							},
                            {
                                "name": "AllowAdditionalWVDNetwork",
                                "priority": 103,
                                "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                                "action": {
                                    "type": "Allow"
                                },
                                "rules": [
                                    {
                                        "ruleType": "NetworkRule",
                                        "name": "AllowADDNS",
                                        "ipProtocols": [
											"TCP",
											"UDP"
                                        ],
                                        "sourceAddresses": [
                                            "*"
                                        ],
                                        "destinationAddresses": [
											"ZZ.ZZ.ZZ.ZZ"
										],
                                        "sourceIpGroups": [],
                                        "destinationIpGroups": [],
                                        "destinationFqdns": [],
                                        "destinationPorts": [
                                            "53"
                                        ]
                                    },									
									{
                                        "ruleType": "NetworkRule",
                                        "name": "AllowAzureKMS",
                                        "ipProtocols": [
                                            "TCP"
                                        ],
                                        "sourceAddresses": [
                                            "*"
                                        ],
                                        "destinationAddresses": [],
                                        "sourceIpGroups": [],
                                        "destinationIpGroups": [],
                                        "destinationFqdns": [
                                            "kms.core.windows.net"
                                        ],
                                        "destinationPorts": [
                                            "1688"
                                        ]
									},
                                    {
                                        "ruleType": "NetworkRule",
                                        "name": "AllowWindowsNTP",
                                        "ipProtocols": [
                                            "UDP"
                                        ],
                                        "sourceAddresses": [
                                            "*"
                                        ],
                                        "destinationAddresses": [],
                                        "sourceIpGroups": [],
                                        "destinationIpGroups": [],
                                        "destinationFqdns": [
                                            "time.windows.com"
                                        ],
                                        "destinationPorts": [
                                            "123"
                                        ]
                                    }
                                ]
							}